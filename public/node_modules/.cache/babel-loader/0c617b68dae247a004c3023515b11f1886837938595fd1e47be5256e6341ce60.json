{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { toast } from \"react-toastify\";\nimport apiService from \"../../app/apiService\";\nimport { REVIEWS_PER_PRODUCT } from \"../../app/config\";\nconst initialState = {\n  isLoading: false,\n  error: null,\n  reviewsByProduct: {},\n  totalReviewsByProduct: {},\n  currentPageByProduct: [],\n  reviewsById: {}\n};\nconst slice = createSlice({\n  name: \"review\",\n  initialState,\n  reducers: {\n    startLoading(state) {\n      state.isLoading = true;\n    },\n    hasError(state, action) {\n      state.isLoading = false;\n      state.error = action.payload;\n    },\n    createReviewSuccess(state, action) {\n      state.isLoading = false;\n      state.error = null;\n    },\n    getReviewsSuccess(state, action) {\n      state.isLoading = false;\n      state.error = \"\";\n      console.log(action.payload);\n      const {\n        productId,\n        review,\n        count,\n        page\n      } = action.payload;\n      review.forEach(review => state.reviewsById[review._id] = review);\n      state.reviewsByProduct[productId] = review.map(review => review._id).reverse();\n      state.totalReviewsByProduct[productId] = count;\n      console.log(\"count\", count);\n      state.currentPageByProduct[productId] = page;\n    },\n    sendReviewReactionSuccess(state, action) {\n      state.isLoading = false;\n      state.error = null;\n      const {\n        reviewId,\n        reactions\n      } = action.payload;\n      state.reviewsById[reviewId].totalRatings = reactions.totalRatings;\n      state.reviewsById[reviewId].rateAverage = reactions.rateAverage;\n    },\n    deleteReviewSuccess(state, action) {\n      state.isLoading = false;\n      state.error = null;\n      const {\n        _id,\n        product\n      } = action.payload;\n      state.reviewsByProduct[product] = state.reviewsByProduct[product].filter(reviewId => reviewId !== action.payload._id);\n      delete state.reviewsById[_id];\n      state.totalReviewsByPoduct[product] -= 1;\n    },\n    editReviewSuccess(state, action) {\n      state.isLoading = false;\n      state.error = null;\n      const {\n        _id,\n        content\n      } = action.payload;\n      state.reviewsById[_id].content = content;\n    }\n  }\n});\nexport default slice.reducer;\nexport const createReview = _ref => {\n  let {\n    productId,\n    content,\n    userId\n  } = _ref;\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n    try {\n      const response = await apiService.post(`/reviews/me/${productId}`, {\n        content,\n        userId\n      });\n      dispatch(slice.actions.createReviewSuccess(response.data));\n      dispatch(getReviews({\n        productId\n      }));\n    } catch (error) {\n      dispatch(slice.actions.hasError(error.message));\n      toast.error(error.message);\n    }\n  };\n};\nexport const getReviews = _ref2 => {\n  let {\n    productId,\n    page = 1,\n    limit = REVIEWS_PER_PRODUCT\n  } = _ref2;\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n    try {\n      const params = {\n        page: page,\n        limit: limit\n      };\n      const response = await apiService.get(`/reviews/public/${productId}`, {\n        params\n      });\n      if (response) {\n        dispatch(slice.actions.getReviewsSuccess({\n          ...response.data,\n          productId,\n          page\n        }));\n      }\n    } catch (error) {\n      dispatch(slice.actions.hasError(error.message));\n    }\n  };\n};\nexport const sendReviewReaction = _ref3 => {\n  let {\n    reviewId,\n    rate,\n    userId\n  } = _ref3;\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n    try {\n      const response = await apiService.post(`/reactions`, {\n        refPaths: \"Review\",\n        targetId: reviewId,\n        userId: userId,\n        rate\n      });\n      dispatch(slice.actions.sendReviewReactionSuccess({\n        reviewId,\n        reactions: response.data\n      }));\n    } catch (error) {\n      dispatch(slice.actions.hasError(error.message));\n      toast.error(error.message);\n    }\n  };\n};\nexport const deleteReview = reviewId => async dispatch => {\n  dispatch(slice.actions.startLoading());\n  try {\n    const response = await apiService.delete(`/reviews/me/${reviewId}`);\n    dispatch(slice.actions.deleteReviewSuccess(response.data));\n    toast.success(\"Delete successfully\");\n  } catch (error) {\n    dispatch(slice.actions.hasError(error.message));\n    toast.error(error.message);\n  }\n};\nexport const editReview = _ref4 => {\n  let {\n    reviewId,\n    content\n  } = _ref4;\n  return async dispatch => {\n    dispatch(slice.actions.startLoading());\n    try {\n      const response = await apiService.put(`/reviews/me${reviewId}`, {\n        content\n      });\n      dispatch(slice.actions.editReviewSuccess(response.data));\n      toast.success(\"Edit successfully\");\n    } catch (error) {\n      dispatch(slice.actions.hasError(error.message));\n      toast.error(error.message);\n    }\n  };\n};","map":{"version":3,"names":["createSlice","toast","apiService","REVIEWS_PER_PRODUCT","initialState","isLoading","error","reviewsByProduct","totalReviewsByProduct","currentPageByProduct","reviewsById","slice","name","reducers","startLoading","state","hasError","action","payload","createReviewSuccess","getReviewsSuccess","console","log","productId","review","count","page","forEach","_id","map","reverse","sendReviewReactionSuccess","reviewId","reactions","totalRatings","rateAverage","deleteReviewSuccess","product","filter","totalReviewsByPoduct","editReviewSuccess","content","reducer","createReview","userId","dispatch","actions","response","post","data","getReviews","message","limit","params","get","sendReviewReaction","rate","refPaths","targetId","deleteReview","delete","success","editReview","put"],"sources":["D:/Gitlab/dinhngocliennhi1999_frontend/src/features/review/reviewSlice.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\nimport { toast } from \"react-toastify\";\r\nimport apiService from \"../../app/apiService\";\r\nimport { REVIEWS_PER_PRODUCT } from \"../../app/config\";\r\n\r\nconst initialState = {\r\n  isLoading: false,\r\n  error: null,\r\n  reviewsByProduct: {},\r\n  totalReviewsByProduct: {},\r\n  currentPageByProduct: [],\r\n  reviewsById: {},\r\n\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"review\",\r\n  initialState,\r\n  reducers: {\r\n    startLoading(state) {\r\n      state.isLoading = true;\r\n    },\r\n    hasError(state, action) {\r\n      state.isLoading = false;\r\n      state.error = action.payload;\r\n    },\r\n    createReviewSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.error = null;\r\n    },\r\n    getReviewsSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.error = \"\";\r\n      console.log(action.payload);\r\n      const { productId, review, count, page } = action.payload;\r\n      review.forEach((review) => (state.reviewsById[review._id] = review));\r\n      state.reviewsByProduct[productId] = review\r\n        .map((review) => review._id)\r\n        .reverse();\r\n      state.totalReviewsByProduct[productId] = count;\r\n      console.log(\"count\", count)\r\n      state.currentPageByProduct[productId] = page;\r\n    },\r\n  \r\n    sendReviewReactionSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.error = null;\r\n      const { reviewId, reactions } = action.payload;\r\n\r\n      state.reviewsById[reviewId].totalRatings = reactions.totalRatings;\r\n      state.reviewsById[reviewId].rateAverage = reactions.rateAverage;\r\n    },\r\n    deleteReviewSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.error = null;\r\n      const { _id, product } = action.payload;\r\n      state.reviewsByProduct[product] = state.reviewsByProduct[product].filter(\r\n        (reviewId) => reviewId !== action.payload._id\r\n      );\r\n      delete state.reviewsById[_id];\r\n      state.totalReviewsByPoduct[product] -= 1;\r\n    },\r\n    editReviewSuccess(state, action) {\r\n      state.isLoading = false;\r\n      state.error = null;\r\n      const { _id, content } = action.payload;\r\n      state.reviewsById[_id].content = content;\r\n    },\r\n  },\r\n});\r\nexport default slice.reducer;\r\n\r\nexport const createReview =\r\n  ({ productId, content, userId }) =>\r\n  async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const response = await apiService.post(`/reviews/me/${productId}`, {\r\n        content, userId\r\n       \r\n      });\r\n      dispatch(slice.actions.createReviewSuccess(response.data));\r\n      dispatch(getReviews({ productId }));\r\n    } catch (error) {\r\n      dispatch(slice.actions.hasError(error.message));\r\n      toast.error(error.message);\r\n    }\r\n  };\r\n\r\nexport const getReviews =\r\n  ({ productId, page = 1, limit = REVIEWS_PER_PRODUCT }) =>\r\n  async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const params = {\r\n        page: page,\r\n        limit: limit,\r\n      };\r\n      const response = await apiService.get(`/reviews/public/${productId}`, {\r\n        params,\r\n      });\r\n       if (response) {\r\n       dispatch(\r\n        slice.actions.getReviewsSuccess({\r\n          ...response.data,\r\n          productId,\r\n          page,\r\n        })\r\n      );\r\n\r\n    }\r\n    } catch (error) {\r\n      dispatch(slice.actions.hasError(error.message));\r\n    }\r\n  };\r\n\r\nexport const sendReviewReaction =\r\n  ({ reviewId, rate, userId }) =>\r\n  async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const response = await apiService.post(`/reactions`, {\r\n        refPaths: \"Review\",\r\n        targetId: reviewId,\r\n        userId: userId,\r\n        rate,\r\n      });\r\n      dispatch(\r\n        slice.actions.sendReviewReactionSuccess({\r\n          reviewId,\r\n          reactions: response.data,\r\n        })\r\n      );\r\n    } catch (error) {\r\n      dispatch(slice.actions.hasError(error.message));\r\n      toast.error(error.message);\r\n    }\r\n  };\r\n\r\nexport const deleteReview = (reviewId) => async (dispatch) => {\r\n  dispatch(slice.actions.startLoading());\r\n  try {\r\n    const response = await apiService.delete(`/reviews/me/${reviewId}`);\r\n    dispatch(slice.actions.deleteReviewSuccess(response.data));\r\n\r\n    toast.success(\"Delete successfully\");\r\n  } catch (error) {\r\n    dispatch(slice.actions.hasError(error.message));\r\n    toast.error(error.message);\r\n  }\r\n};\r\n\r\nexport const editReview =\r\n  ({ reviewId, content }) =>\r\n  async (dispatch) => {\r\n    dispatch(slice.actions.startLoading());\r\n    try {\r\n      const response = await apiService.put(`/reviews/me${reviewId}`, {\r\n        content,\r\n      });\r\n      dispatch(slice.actions.editReviewSuccess(response.data));\r\n\r\n      toast.success(\"Edit successfully\");\r\n    } catch (error) {\r\n      dispatch(slice.actions.hasError(error.message));\r\n      toast.error(error.message);\r\n    }\r\n  };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}