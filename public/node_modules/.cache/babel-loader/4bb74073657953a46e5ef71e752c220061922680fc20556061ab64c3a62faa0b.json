{"ast":null,"code":"var _jsxFileName = \"D:\\\\Github\\\\Final-food\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useReducer, useEffect } from \"react\";\nimport apiService from \"../app/apiService\";\nimport { isValidToken } from \"../utils/jwt\";\nimport { useSelector } from \"react-redux\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null\n};\nconst INITIALIZE = \"INITIALIZE\";\nconst LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nconst REGISTER_SUCCESS = \"AUTH.REGISTER_SUCCESS\";\nconst LOGOUT = \"LOGOUT\";\nconst UPDATE_PROFILE = \"AUTH.UPDATE_PROFILE\";\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case INITIALIZE:\n      const {\n        isAuthenticated,\n        user\n      } = action.payload;\n      return {\n        ...state,\n        isAuthenticated,\n        isInitialized: true,\n        user\n      };\n    case LOGIN_SUCCESS:\n      return {\n        ...state,\n        isAuthenticated: true,\n        user: action.payload.user\n      };\n    case LOGOUT:\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: null\n      };\n    default:\n      return state;\n  }\n};\nconst AuthContext = /*#__PURE__*/createContext({\n  ...initialState\n});\n// save accessToken\nconst setSession = accessToken => {\n  if (accessToken) {\n    window.localStorage.setItem(\"accessToken\", accessToken);\n    apiService.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    window.localStorage.removeItem(\"accessToken\");\n    delete apiService.defaults.headers.common.Authorization;\n  }\n};\nfunction AuthProvider(_ref) {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialState);\n  useEffect(() => {\n    const initialize = async () => {\n      try {\n        const accessToken = window.localStorage.getItem(\"accessToken\");\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const response = await apiService.get(\"/users/me\");\n          const user = response.data;\n          // console.log(\"user\", response.data.data);\n          dispatch({\n            type: INITIALIZE,\n            payload: {\n              isAuthenticated: true,\n              user\n            }\n          });\n        } else {\n          setSession(null);\n          dispatch({\n            type: INITIALIZE,\n            payload: {\n              isAuthenticated: false,\n              user: null\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        setSession(null);\n        dispatch({\n          type: INITIALIZE,\n          payload: {\n            isAuthenticated: false,\n            user: null\n          }\n        });\n      }\n    };\n    initialize();\n  }, []);\n  const login = async (_ref2, callback) => {\n    let {\n      email,\n      password\n    } = _ref2;\n    const response = await apiService.post(\"/auth/login\", {\n      email,\n      password\n    });\n    const {\n      user,\n      accessToken\n    } = response.data.data;\n    setSession(accessToken);\n    dispatch({\n      type: LOGIN_SUCCESS,\n      payload: {\n        user\n      }\n    });\n    callback();\n  };\n  const logout = callback => {\n    setSession(null);\n    dispatch({\n      type: LOGOUT\n    });\n    callback();\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      ...state,\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n_c = AuthProvider;\nexport { AuthContext, AuthProvider };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useReducer","useEffect","apiService","isValidToken","useSelector","initialState","isAuthenticated","isInitialized","user","INITIALIZE","LOGIN_SUCCESS","REGISTER_SUCCESS","LOGOUT","UPDATE_PROFILE","reducer","state","action","type","payload","AuthContext","setSession","accessToken","window","localStorage","setItem","defaults","headers","common","Authorization","removeItem","AuthProvider","children","dispatch","initialize","getItem","response","get","data","err","console","error","login","callback","email","password","post","logout"],"sources":["D:/Github/Final-food/src/contexts/AuthContext.js"],"sourcesContent":["import { createContext, useReducer, useEffect } from \"react\";\r\nimport apiService from \"../app/apiService\";\r\nimport { isValidToken } from \"../utils/jwt\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\n\r\n\r\n\r\nconst initialState = {\r\n  isAuthenticated: false,\r\n  isInitialized: false,\r\n  user: null,\r\n};\r\n\r\nconst INITIALIZE = \"INITIALIZE\";\r\nconst LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\r\nconst REGISTER_SUCCESS = \"AUTH.REGISTER_SUCCESS\";\r\nconst LOGOUT = \"LOGOUT\";\r\nconst UPDATE_PROFILE = \"AUTH.UPDATE_PROFILE\";\r\n\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case INITIALIZE:\r\n      const \r\n      { isAuthenticated, user } = action.payload;\r\n      return {\r\n        ...state,\r\n        isAuthenticated,\r\n        isInitialized: true,\r\n        user,\r\n      };\r\n    case LOGIN_SUCCESS:\r\n      return {\r\n        ...state,\r\n        isAuthenticated: true,\r\n        user: action.payload.user,\r\n      };\r\n    case LOGOUT:\r\n      return {\r\n        ...state,\r\n        isAuthenticated: false,\r\n        user: null,\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nconst AuthContext = createContext({ ...initialState });\r\n// save accessToken\r\nconst setSession = (accessToken) => {\r\n  if (accessToken) {\r\n    window.localStorage.setItem(\"accessToken\", accessToken);\r\n    apiService.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\r\n  } else {\r\n    window.localStorage.removeItem(\"accessToken\");\r\n    delete apiService.defaults.headers.common.Authorization;\r\n  }\r\n};\r\n\r\n\r\nfunction AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\nuseEffect(() => {\r\n    const initialize = async () => {\r\n      try {\r\n        const accessToken = window.localStorage.getItem(\"accessToken\");\r\n\r\n        if (accessToken && isValidToken(accessToken)) {\r\n          setSession(accessToken);\r\n\r\n          const response = await apiService.get(\"/users/me\");\r\n          const user = response.data;\r\n          // console.log(\"user\", response.data.data);\r\n          dispatch({\r\n            type: INITIALIZE,\r\n            payload: { isAuthenticated: true, user },\r\n          });\r\n        } else {\r\n          setSession(null);\r\n\r\n          dispatch({\r\n            type: INITIALIZE,\r\n            payload: { isAuthenticated: false, user: null },\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n\r\n        setSession(null);\r\n        dispatch({\r\n          type: INITIALIZE,\r\n          payload: {\r\n            isAuthenticated: false,\r\n            user: null,\r\n          },\r\n        });\r\n      }\r\n    };\r\n\r\n    initialize();\r\n  }, []);\r\n\r\n\r\n const login = async ({ email, password }, callback) => {\r\n    const response = await apiService.post(\"/auth/login\", { email, password });\r\n    const { user, accessToken } = response.data.data;\r\n    setSession(accessToken);\r\n    dispatch({\r\n      type: LOGIN_SUCCESS,\r\n      payload: { user },\r\n    });\r\n\r\n    callback();\r\n  };\r\n\r\n const logout = (callback) => {\r\n    setSession(null);\r\n    dispatch({\r\n      type: LOGOUT,\r\n    });\r\n    callback();\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        ...state,\r\n        login,\r\n        logout,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport { AuthContext, AuthProvider };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}